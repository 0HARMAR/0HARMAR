# 计算机启动过程

## 概述
从电源接通到操作系统加载完成，计算机启动分为以下核心阶段：

---

## 1. 电源启动与硬件初始化
- **电源供应**：主板、CPU、内存等组件通电。
- **CPU复位**：CPU从固定地址（`0xFFFF0`，BIOS入口）开始执行指令。

---

## 2. BIOS/UEFI自检（POST）
### 传统BIOS
- **POST（Power-On Self Test）**：检测内存、显卡、硬盘等硬件。
- **错误反馈**：蜂鸣声（如`1长2短`表示显卡故障）或屏幕错误码。

### UEFI（统一可扩展固件接口）
- **快速自检**：并行硬件检测，支持图形界面。
- **Secure Boot**：验证操作系统引导文件签名，防止恶意代码。

---

## 3. 引导设备选择
- **启动顺序**：按BIOS/UEFI配置（如`硬盘 > USB > 网络`）搜索可启动设备。
- **引导记录读取**：
  - **BIOS + MBR**：读取硬盘首个扇区（512字节的MBR）。
    ```plaintext
    MBR结构：
    - 引导代码（446字节）
    - 分区表（64字节，最多4个主分区）
    - 签名（0x55AA，2字节）
    ```
  - **UEFI + GPT**：直接访问EFI系统分区（ESP）中的`.efi`文件。

---

## 4. 引导加载程序（Boot Loader）
- **BIOS模式**：
  - **示例**：GRUB（Linux）、`bootmgr`（Windows）。
  - **功能**：提供多系统菜单、加载内核至内存。
- **UEFI模式**：
  - **直接加载**：调用操作系统的`.efi`文件（如`\EFI\Microsoft\Boot\bootmgfw.efi`）。

---

## 5. 操作系统内核加载
- **内核载入**：如Linux的`vmlinuz`或Windows的`ntoskrnl.exe`。
- **initramfs（Linux）**：临时根文件系统，加载必要驱动（如RAID、LVM）。

---

## 6. 内核初始化与用户空间启动
1. **内核初始化**：
   - 驱动加载（如磁盘、网络）。
   - 挂载根文件系统（如`ext4`或`NTFS`）。
2. **用户空间启动**：
   - **Linux**：启动`systemd`（PID=1），加载服务（`sshd`, `network`等）。
   - **Windows**：启动`winlogon.exe`，显示登录界面。

---

## BIOS vs UEFI 对比
| 特性                | BIOS                  | UEFI                          |
|---------------------|-----------------------|-------------------------------|
| **启动模式**        | 16位实模式            | 32/64位保护模式               |
| **引导方式**        | MBR（最大2TB分区）    | GPT（支持>2TB分区）           |
| **启动速度**        | 较慢                  | 更快（支持并行初始化）         |
| **安全性**          | 无Secure Boot         | 支持Secure Boot               |
| **图形界面**        | 文本界面              | 支持图形化配置界面            |

---

## 注释
- **Secure Boot**：需操作系统（如Windows 11）和硬件（TPM芯片）支持。
- **双系统引导**：UEFI模式下需通过`efibootmgr`（Linux）或`bcdedit`（Windows）配置。