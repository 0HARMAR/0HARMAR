# 16位实模式BIOS中断

---

## 一、视频服务中断（INT 0x10）

### 功能表
| AH   | 功能描述               | 参数                                                                 | 返回值               |
|------|------------------------|----------------------------------------------------------------------|----------------------|
| 0x00 | 设置显示模式           | `AL=显示模式`（如 `0x03` 为 80x25 文本模式）                        | 无                   |
| 0x01 | 设置光标形状           | `CH=光标起始行`, `CL=光标结束行`                                    | 无                   |
| 0x02 | 设置光标位置           | `BH=页号`, `DH=行`, `DL=列`                                         | 无                   |
| 0x03 | 获取光标位置和形状     | `BH=页号`                                                           | `DH=行`, `DL=列`, `CH/CL=光标形状` |
| 0x0E | 打印字符（TTY模式）    | `AL=字符`, `BH=页号`, `BL=颜色`（仅图形模式有效）                   | 无                   |
| 0x13 | 打印字符串             | `ES:BP=字符串地址`, `CX=字符串长度`, `BH=页号`, `BL=颜色`, `AL=模式` | 无                   |

### 示例代码
#### 1. 打印字符（功能号 0x0E）
```asm
movb $0x0E, %ah     ; 功能号：打印字符
movb $'A', %al      ; 字符 'A'
movb $0x00, %bh     ; 页号 0
movb $0x07, %bl     ; 颜色：灰底黑字（0x07）
int  $0x10
```

## BIOS 磁盘服务中断（INT 0x13）

---

## 功能表

| AH   | 功能描述               | 参数                                                                 | 返回值               |
|------|------------------------|----------------------------------------------------------------------|----------------------|
| 0x02 | 读取磁盘扇区           | `AL=扇区数`, `CH=柱面`, `CL=扇区`, `DH=磁头`, `DL=驱动器号`, `ES:BX=缓冲区地址` | `CF=0` 成功，`AH=状态码` |
| 0x03 | 写入磁盘扇区           | 参数同上                                                             | 同上                 |
| 0x08 | 获取磁盘参数           | `DL=驱动器号`                                                       | `CH=最大柱面`, `DH=最大磁头`, `CL=每磁道扇区数` |
| 0x15 | 获取磁盘类型           | `DL=驱动器号`                                                       | `AH=类型码`（0x02 为硬盘） |
| 0x05 | 格式化磁道             | `CH=柱面`, `DH=磁头`, `DL=驱动器号`, `ES:BX=格式化参数表`            | `CF=0` 成功          |

---

## 示例代码

### 1. 读取硬盘第一个扇区（主引导记录）
```asm
movb $0x02, %ah     ; 功能号：读扇区
movb $1, %al        ; 读取 1 个扇区
movw $0x0000, %bx   ; ES:BX = 0x0000:0x7C00（MBR加载地址）
movw %bx, %es
movb $0x00, %ch     ; 柱面 0
movb $0x00, %dh     ; 磁头 0
movb $0x01, %cl     ; 扇区 1（BIOS计数从1开始）
movb $0x80, %dl     ; 驱动器号 0x80（第一硬盘）
int  $0x13
jc   disk_error     ; 若出错（CF=1），跳转错误处理
```


# BIOS 键盘服务中断（INT 0x16）

---

## 功能表

| AH   | 功能描述               | 参数              | 返回值               |
|------|------------------------|-------------------|----------------------|
| 0x00 | 读取键盘输入           | 无                | `AL=ASCII码`, `AH=扫描码` |
| 0x01 | 检查键盘缓冲区         | 无                | `ZF=1` 无按键，`ZF=0` 有按键 |
| 0x02 | 获取键盘状态标志       | 无                | `AL=状态字节`（CapsLock等） |
| 0x05 | 设置键盘重复速率       | `AL=重复速率`, `BH=延迟` | 无                 |
| 0x10 | 扩展键盘输入（支持功能键） | 无               | `AX=键码`（高字节为扫描码） |

---

## 示例代码

### 1. 阻塞等待按键输入
```asm
movb $0x00, %ah     ; 功能号：读取按键
int  $0x16          ; 阻塞直到按键，AL=ASCII码
; AX = 键码（AH=扫描码，AL=ASCII码）
```

[完整中断](http://www.ctyme.com/intr/int.htm)